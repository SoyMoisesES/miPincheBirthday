<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atrapa la Langosta - Torneo</title>
    <style>
        :root { --bg-color: #0b00d8; --text-color: #ffffff; --accent-green: #00ff00; --font-main: 'Courier New', Courier, monospace; }
        body { background-color: var(--bg-color); color: var(--text-color); font-family: var(--font-main); padding: 20px; text-align: center; user-select: none; }
        
        .game-container { max-width: 800px; margin: 0 auto; border: 2px solid var(--accent-green); padding: 20px; background: rgba(0,0,0,0.3); }
        
        #game-area {
            width: 100%; height: 400px; border: 1px dashed white; margin: 20px 0;
            position: relative; overflow: hidden; background: #000; cursor: crosshair;
        }
        
        #game-target {
            width: 70px; height: 70px; position: absolute; cursor: pointer;
            transition: top 0.1s, left 0.1s; 
        }

        .score-board { font-size: 2rem; color: var(--accent-green); font-weight: bold; display: flex; justify-content: space-between; padding: 0 20px; }
        
        .yellow-btn { background-color: var(--accent-green); color: #000; border: none; padding: 15px 30px; font-weight: bold; cursor: pointer; font-size: 1.2rem; font-family: inherit; margin-top: 10px;}
        input { padding: 10px; font-size: 1.2rem; width: 80%; margin-bottom: 10px; font-family: inherit;}

        /* ESTILOS DE LA TABLA DE L√çDERES */
        .leaderboard { margin-top: 30px; border-top: 1px dashed #fff; padding-top: 20px; text-align: left;}
        .leaderboard h3 { color: var(--accent-green); text-align: center; }
        .leader-row { display: flex; justify-content: space-between; padding: 5px 10px; border-bottom: 1px solid #333; }
        .leader-row:first-child { color: yellow; font-weight: bold; font-size: 1.2rem; } /* El l√≠der en amarillo */
    </style>
</head>
<body>

    <div class="game-container">
        <h1>ü¶û ATRAPA LA LANGOSTA ü¶û</h1>
        <p style="font-size: 0.9rem;">El que haga m√°s puntos se lleva premio el d√≠a de la fiesta.</p>
        
        <div class="score-board">
            <span>PTS: <span id="score">0</span></span>
            <span>TIEMPO: <span id="timer">15</span>s</span>
        </div>

        <div id="start-screen">
            <button class="yellow-btn" onclick="startGame()">¬°JUGAR!</button>
        </div>

        <div id="game-area" style="display:none;">
            <img src="langosta.jpg" id="game-target" onmousedown="hitTarget()" alt="Langosta">
        </div>

        <div id="end-screen" style="display:none;">
            <h2 style="color: var(--accent-green);">¬°TIEMPO FUERA!</h2>
            <p style="font-size: 1.5rem;">Hiciste <span id="final-score" style="color: white; font-weight:bold;">0</span> puntos.</p>
            
            <div id="save-form">
                <p>Guarda tu r√©cord para entrar al ranking:</p>
                <input type="text" id="player-name" placeholder="Tu Nombre o Apodo">
                <br>
                <button class="yellow-btn" id="btn-save" onclick="saveScore()">GUARDAR R√âCORD</button>
            </div>
            <div id="save-success" style="display:none; color: var(--accent-green); font-weight: bold; margin-top: 20px;">
                ¬°R√âCORD GUARDADO!
            </div>
            
            <br><br>
            <button onclick="location.reload()" style="background:none; border:1px solid white; color:white; padding:10px; cursor:pointer;">Jugar de nuevo</button>
            <a href="index.html" style="color: white; margin-left: 15px;">Volver al inicio</a>
        </div>

        <div class="leaderboard">
            <h3>üèÜ TOP JUGADORES üèÜ</h3>
            <div id="leaderboard-list">
                <p style="text-align:center; color:#888;">Cargando tabla...</p>
            </div>
        </div>
    </div>

    <script>
        // -----------------------------------------------------------
        // PEGA AQU√ç LA NUEVA URL DE TU SEGUNDO SCRIPT (HOJA RECORDS)
        // -----------------------------------------------------------
        const SCRIPT_URL_SCORES = "https://script.google.com/macros/s/AKfycbw3ywXIV9CTnPOuZn3npIm-rIFVgyONQh0QB2n2JX2Y6sGNfItilb6SMiGyfkVESulJ3w/exec"; 
        // -----------------------------------------------------------

        let score = 0;
        let timeLeft = 15;
        let gameInterval;
        let moveInterval;

        // Cargar l√≠deres al entrar
        window.addEventListener('load', loadLeaderboard);

        function startGame() {
            score = 0;
            timeLeft = 15;
            document.getElementById('score').innerText = score;
            document.getElementById('timer').innerText = timeLeft;
            
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('end-screen').style.display = 'none';
            document.getElementById('save-form').style.display = 'block';
            document.getElementById('save-success').style.display = 'none';
            document.getElementById('game-area').style.display = 'block';

            gameInterval = setInterval(updateTimer, 1000);
            moveInterval = setInterval(moveTarget, 600); 
        }

        function updateTimer() {
            timeLeft--;
            document.getElementById('timer').innerText = timeLeft;
            if(timeLeft <= 0) endGame();
        }

        function moveTarget() {
            const area = document.getElementById('game-area');
            const target = document.getElementById('game-target');
            // Restamos el tama√±o de la langosta (70px)
            const maxX = area.clientWidth - 70;
            const maxY = area.clientHeight - 70;
            
            const randomX = Math.floor(Math.random() * maxX);
            const randomY = Math.floor(Math.random() * maxY);

            target.style.left = randomX + 'px';
            target.style.top = randomY + 'px';
        }

        function hitTarget() {
            score++;
            document.getElementById('score').innerText = score;
            moveTarget(); 
            // Aumenta la dificultad (m√°s r√°pido) cada vez que le das
            clearInterval(moveInterval);
            moveInterval = setInterval(moveTarget, 500); 
        }

        function endGame() {
            clearInterval(gameInterval);
            clearInterval(moveInterval);
            document.getElementById('game-area').style.display = 'none';
            document.getElementById('end-screen').style.display = 'block';
            document.getElementById('final-score').innerText = score;
        }

        function saveScore() {
            const name = document.getElementById('player-name').value;
            const btn = document.getElementById('btn-save');
            
            if(!name) { alert("Escribe tu nombre"); return; }

            btn.innerText = "GUARDANDO...";
            btn.disabled = true;

            if(SCRIPT_URL_SCORES !== "PEGAR_TU_NUEVA_URL_AQUI") {
                 fetch(SCRIPT_URL_SCORES, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {'Content-Type': 'application/x-www-form-urlencoded'},
                    // Enviamos 'puntos' como n√∫mero
                    body: `nombre=${encodeURIComponent(name)}&puntos=${score}`
                }).then(() => {
                    document.getElementById('save-form').style.display = 'none';
                    document.getElementById('save-success').style.display = 'block';
                    // Recargar tabla de l√≠deres
                    setTimeout(loadLeaderboard, 1000);
                }).catch(() => {
                    alert("Error de conexi√≥n");
                    btn.disabled = false;
                    btn.innerText = "GUARDAR R√âCORD";
                });
            } else {
                alert("Guardado (Modo Simulaci√≥n)");
                document.getElementById('save-form').style.display = 'none';
            }
        }

        function loadLeaderboard() {
            if(SCRIPT_URL_SCORES === "PEGAR_TU_NUEVA_URL_AQUI") return;

            fetch(SCRIPT_URL_SCORES)
            .then(response => response.json())
            .then(data => {
                const list = document.getElementById('leaderboard-list');
                list.innerHTML = "";
                
                if (data.length === 0) {
                    list.innerHTML = '<p style="text-align:center;">A√∫n no hay r√©cords.</p>';
                    return;
                }

                // El script de Google ya nos devuelve los datos ordenados del Top 10
                data.forEach((jugador, index) => {
                    let rank = index + 1;
                    let medal = "";
                    if(rank === 1) medal = "üëë ";
                    else if(rank === 2) medal = "ü•à ";
                    else if(rank === 3) medal = "ü•â ";

                    const row = document.createElement('div');
                    row.className = 'leader-row';
                    row.innerHTML = `
                        <span>${medal}#${rank} ${jugador.nombre.toUpperCase()}</span>
                        <span>${jugador.puntos} pts</span>
                    `;
                    list.appendChild(row);
                });
            });
        }
    </script>
</body>
</html>